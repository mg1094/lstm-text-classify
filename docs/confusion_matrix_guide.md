# æ··æ·†çŸ©é˜µè¯¦è§£

## ğŸ“Š æ¦‚è¿°

æ··æ·†çŸ©é˜µï¼ˆConfusion Matrixï¼‰æ˜¯æœºå™¨å­¦ä¹ åˆ†ç±»ä»»åŠ¡ä¸­æœ€é‡è¦çš„è¯„ä¼°å·¥å…·ä¹‹ä¸€ã€‚å®ƒä»¥è¡¨æ ¼å½¢å¼ç›´è§‚å±•ç¤ºåˆ†ç±»æ¨¡å‹çš„é¢„æµ‹ç»“æœä¸çœŸå®æ ‡ç­¾çš„å¯¹æ¯”æƒ…å†µï¼Œå¸®åŠ©æˆ‘ä»¬æ·±å…¥ç†è§£æ¨¡å‹çš„æ€§èƒ½è¡¨ç°ã€‚

## ğŸ¯ åŸºæœ¬å®šä¹‰

æ··æ·†çŸ©é˜µæ˜¯ä¸€ä¸ª **NÃ—N çš„è¡¨æ ¼**ï¼ˆNä¸ºç±»åˆ«æ•°é‡ï¼‰ï¼Œå…¶ä¸­ï¼š
- **è¡Œ**ï¼šä»£è¡¨çœŸå®æ ‡ç­¾ï¼ˆGround Truthï¼‰
- **åˆ—**ï¼šä»£è¡¨é¢„æµ‹ç»“æœï¼ˆPredictionï¼‰
- **æ¯ä¸ªå•å…ƒæ ¼**ï¼šè¡¨ç¤ºå¯¹åº”çœŸå®æ ‡ç­¾å’Œé¢„æµ‹æ ‡ç­¾çš„æ ·æœ¬æ•°é‡

## ğŸ“ˆ äºŒåˆ†ç±»æ··æ·†çŸ©é˜µ

å¯¹äºäºŒåˆ†ç±»é—®é¢˜ï¼ˆå¦‚æ­£é¢/è´Ÿé¢æƒ…æ„Ÿåˆ†æï¼‰ï¼Œæ··æ·†çŸ©é˜µæ˜¯ä¸€ä¸ª2Ã—2çš„è¡¨æ ¼ï¼š

```
                    é¢„æµ‹ç»“æœ
                 æ­£é¢    è´Ÿé¢
çœŸå®æ ‡ç­¾  æ­£é¢    TP      FN
         è´Ÿé¢    FP      TN
```

### æœ¯è¯­è§£é‡Š

- **TP (True Positive)**ï¼šçœŸæ­£ä¾‹ - å®é™…ä¸ºæ­£é¢ï¼Œé¢„æµ‹ä¹Ÿä¸ºæ­£é¢ âœ…
- **TN (True Negative)**ï¼šçœŸè´Ÿä¾‹ - å®é™…ä¸ºè´Ÿé¢ï¼Œé¢„æµ‹ä¹Ÿä¸ºè´Ÿé¢ âœ…
- **FP (False Positive)**ï¼šå‡æ­£ä¾‹ - å®é™…ä¸ºè´Ÿé¢ï¼Œä½†é¢„æµ‹ä¸ºæ­£é¢ âŒ
- **FN (False Negative)**ï¼šå‡è´Ÿä¾‹ - å®é™…ä¸ºæ­£é¢ï¼Œä½†é¢„æµ‹ä¸ºè´Ÿé¢ âŒ

## ğŸ’¡ å®é™…æ¡ˆä¾‹åˆ†æ

å‡è®¾æˆ‘ä»¬çš„æƒ…æ„Ÿåˆ†ææ¨¡å‹å¤„ç†äº†200ä¸ªè¯„è®ºï¼š

```
                    é¢„æµ‹ç»“æœ
                 æ­£é¢    è´Ÿé¢    æ€»è®¡
çœŸå®æ ‡ç­¾  æ­£é¢    85      15     100
         è´Ÿé¢    12      88     100
         æ€»è®¡    97     103     200
```

### æ¡ˆä¾‹è§£è¯»

- **85ä¸ªæ­£é¢è¯„è®º**è¢«æ­£ç¡®è¯†åˆ«ä¸ºæ­£é¢ï¼ˆTPï¼‰
- **15ä¸ªæ­£é¢è¯„è®º**è¢«é”™è¯¯è¯†åˆ«ä¸ºè´Ÿé¢ï¼ˆFNï¼‰
- **12ä¸ªè´Ÿé¢è¯„è®º**è¢«é”™è¯¯è¯†åˆ«ä¸ºæ­£é¢ï¼ˆFPï¼‰
- **88ä¸ªè´Ÿé¢è¯„è®º**è¢«æ­£ç¡®è¯†åˆ«ä¸ºè´Ÿé¢ï¼ˆTNï¼‰

## ğŸ“Š å…³é”®è¯„ä¼°æŒ‡æ ‡

åŸºäºæ··æ·†çŸ©é˜µï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—ä»¥ä¸‹é‡è¦æŒ‡æ ‡ï¼š

### 1. å‡†ç¡®ç‡ (Accuracy)
```
Accuracy = (TP + TN) / (TP + TN + FP + FN)
         = (85 + 88) / 200 = 86.5%
```
**å«ä¹‰**ï¼šæ‰€æœ‰é¢„æµ‹ä¸­æ­£ç¡®çš„æ¯”ä¾‹

### 2. ç²¾ç¡®ç‡ (Precision)
```
Precision = TP / (TP + FP)
          = 85 / (85 + 12) = 87.6%
```
**å«ä¹‰**ï¼šé¢„æµ‹ä¸ºæ­£é¢çš„æ ·æœ¬ä¸­ï¼Œå®é™…ä¸ºæ­£é¢çš„æ¯”ä¾‹

### 3. å¬å›ç‡ (Recall)
```
Recall = TP / (TP + FN)
       = 85 / (85 + 15) = 85.0%
```
**å«ä¹‰**ï¼šå®é™…ä¸ºæ­£é¢çš„æ ·æœ¬ä¸­ï¼Œè¢«æ­£ç¡®é¢„æµ‹çš„æ¯”ä¾‹

### 4. F1åˆ†æ•° (F1-Score)
```
F1 = 2 Ã— (Precision Ã— Recall) / (Precision + Recall)
   = 2 Ã— (87.6 Ã— 85.0) / (87.6 + 85.0) = 86.3%
```
**å«ä¹‰**ï¼šç²¾ç¡®ç‡å’Œå¬å›ç‡çš„è°ƒå’Œå¹³å‡å€¼

## ğŸ” æ··æ·†çŸ©é˜µè§£è¯»æŠ€å·§

### ç†æƒ³æƒ…å†µ
- **å¯¹è§’çº¿æ•°å€¼å¤§**ï¼šæ­£ç¡®åˆ†ç±»çš„æ ·æœ¬å¤š
- **éå¯¹è§’çº¿æ•°å€¼å°**ï¼šé”™è¯¯åˆ†ç±»çš„æ ·æœ¬å°‘

### å¸¸è§é—®é¢˜è¯†åˆ«

1. **æŸè¡Œéå¯¹è§’çº¿å…ƒç´ å¤§**
   - é—®é¢˜ï¼šè¯¥çœŸå®ç±»åˆ«ç»å¸¸è¢«è¯¯åˆ†ç±»
   - è§£å†³ï¼šå¢åŠ è¯¥ç±»åˆ«çš„è®­ç»ƒæ ·æœ¬ï¼Œæ”¹è¿›ç‰¹å¾æå–

2. **æŸåˆ—éå¯¹è§’çº¿å…ƒç´ å¤§**
   - é—®é¢˜ï¼šæ¨¡å‹å€¾å‘äºè¿‡åº¦é¢„æµ‹è¯¥ç±»åˆ«
   - è§£å†³ï¼šè°ƒæ•´åˆ†ç±»é˜ˆå€¼ï¼Œå¹³è¡¡è®­ç»ƒæ•°æ®

3. **å¯¹è§’çº¿æŸå…ƒç´ å°**
   - é—®é¢˜ï¼šè¯¥ç±»åˆ«è¯†åˆ«èƒ½åŠ›å·®
   - è§£å†³ï¼šæ”¶é›†æ›´å¤šè¯¥ç±»åˆ«çš„é«˜è´¨é‡æ ·æœ¬

## ğŸ—ï¸ é¡¹ç›®ä¸­çš„å®ç°

### ä»£ç å®ç°

åœ¨æˆ‘ä»¬çš„LSTMæ–‡æœ¬åˆ†ç±»é¡¹ç›®ä¸­ï¼Œæ··æ·†çŸ©é˜µé€šè¿‡ä»¥ä¸‹æ–¹å¼ç”Ÿæˆï¼š

```python
def plot_confusion_matrix(self, metrics: Dict, class_names: List[str], save_path: str = "confusion_matrix.png"):
    """ç»˜åˆ¶æ··æ·†çŸ©é˜µ"""
    # 1. è®¡ç®—æ··æ·†çŸ©é˜µ
    cm = confusion_matrix(metrics['targets'], metrics['predictions'])
    
    # 2. åˆ›å»ºçƒ­åŠ›å›¾å¯è§†åŒ–
    plt.figure(figsize=(8, 6))
    sns.heatmap(
        cm,
        annot=True,          # æ˜¾ç¤ºæ•°å€¼
        fmt='d',             # æ•´æ•°æ ¼å¼
        cmap='Blues',        # è“è‰²æ¸å˜
        xticklabels=class_names,  # Xè½´æ ‡ç­¾
        yticklabels=class_names   # Yè½´æ ‡ç­¾
    )
    
    # 3. è®¾ç½®å›¾è¡¨å±æ€§
    plt.title('æ··æ·†çŸ©é˜µ')
    plt.xlabel('é¢„æµ‹æ ‡ç­¾')
    plt.ylabel('çœŸå®æ ‡ç­¾')
    
    # 4. ä¿å­˜å›¾åƒ
    plt.savefig(save_path, dpi=300, bbox_inches='tight')
    plt.show()
```

### ä½¿ç”¨æ–¹æ³•

1. **è®­ç»ƒæ¨¡å‹æ—¶è‡ªåŠ¨ç”Ÿæˆ**ï¼š
   ```bash
   python train.py --epochs 10
   ```

2. **è¾“å‡ºæ–‡ä»¶ä½ç½®**ï¼š
   ```
   output/train_YYYYMMDD_HHMMSS/confusion_matrix.png
   ```

3. **å¯è§†åŒ–ç‰¹ç‚¹**ï¼š
   - ä½¿ç”¨è“è‰²æ¸å˜è¡¨ç¤ºæ•°å€¼å¤§å°
   - æ·±è‰²è¡¨ç¤ºæ•°å€¼å¤§ï¼Œæµ…è‰²è¡¨ç¤ºæ•°å€¼å°
   - æ˜¾ç¤ºå…·ä½“æ•°å­—ä¾¿äºåˆ†æ

## ğŸ¯ åº”ç”¨åœºæ™¯

### 1. æƒ…æ„Ÿåˆ†æ
- **è¯¯å°†è´Ÿé¢è¯†åˆ«ä¸ºæ­£é¢**ï¼šå¯èƒ½å¯¼è‡´å®¢æœé—®é¢˜è¢«å¿½è§†
- **è¯¯å°†æ­£é¢è¯†åˆ«ä¸ºè´Ÿé¢**ï¼šå¯èƒ½é”™å¤±å¥½è¯„çš„ä»·å€¼

### 2. åƒåœ¾é‚®ä»¶æ£€æµ‹
- **æ¼æ£€åƒåœ¾é‚®ä»¶ï¼ˆFNï¼‰**ï¼šç”¨æˆ·æ”¶åˆ°åƒåœ¾é‚®ä»¶
- **è¯¯åˆ æ­£å¸¸é‚®ä»¶ï¼ˆFPï¼‰**ï¼šé‡è¦é‚®ä»¶è¢«è¯¯åˆ ï¼Œåæœæ›´ä¸¥é‡

### 3. åŒ»ç–—è¯Šæ–­
- **æ¼è¯Šï¼ˆFNï¼‰**ï¼šç—…äººå¾—ä¸åˆ°åŠæ—¶æ²»ç–—
- **è¯¯è¯Šï¼ˆFPï¼‰**ï¼šå¥åº·äººæ¥å—ä¸å¿…è¦çš„æ²»ç–—

## ğŸ“‹ æœ€ä½³å®è·µ

### 1. æ•°æ®å¹³è¡¡
- ç¡®ä¿å„ç±»åˆ«æ ·æœ¬æ•°é‡ç›¸å¯¹å‡è¡¡
- å¯¹äºä¸å¹³è¡¡æ•°æ®ï¼Œè€ƒè™‘ä½¿ç”¨åŠ æƒæŒ‡æ ‡

### 2. é˜ˆå€¼è°ƒä¼˜
- æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´åˆ†ç±»é˜ˆå€¼
- ä¼˜å…ˆä¼˜åŒ–å¯¹ä¸šåŠ¡å½±å“æœ€å¤§çš„æŒ‡æ ‡

### 3. æŒç»­ç›‘æ§
- å®šæœŸæ£€æŸ¥æ··æ·†çŸ©é˜µå˜åŒ–
- åŠæ—¶å‘ç°æ¨¡å‹æ€§èƒ½é€€åŒ–

### 4. å¤šè§’åº¦åˆ†æ
- ç»“åˆç²¾ç¡®ç‡ã€å¬å›ç‡ã€F1åˆ†æ•°ç»¼åˆè¯„ä¼°
- ä¸èƒ½ä»…çœ‹å‡†ç¡®ç‡ä¸€ä¸ªæŒ‡æ ‡

## ğŸ”§ é¡¹ç›®ä¸­çš„å®é™…æ•ˆæœ

åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹è®­ç»ƒä¸­ï¼š

```
è®­ç»ƒå‚æ•°ï¼š
- æ•°æ®é›†ï¼š20ä¸ªä¸­æ–‡è¯„è®ºæ ·æœ¬
- è®­ç»ƒè½®æ•°ï¼š3 epochs
- æ¨¡å‹ï¼šåŒå‘LSTM

ç»“æœæŒ‡æ ‡ï¼š
- å‡†ç¡®ç‡ï¼š33.33%
- ç²¾ç¡®ç‡ï¼š11.11%
- å¬å›ç‡ï¼š33.33%
- F1åˆ†æ•°ï¼š16.67%
```

> **æ³¨æ„**ï¼šç”±äºæ•°æ®é‡å¾ˆå°ä¸”è®­ç»ƒè½®æ•°å°‘ï¼Œè¿™äº›ç»“æœä»…ç”¨äºæ¼”ç¤ºã€‚å®é™…åº”ç”¨ä¸­éœ€è¦æ›´å¤šæ•°æ®å’Œæ›´é•¿çš„è®­ç»ƒæ—¶é—´ã€‚

## ğŸ“š æ‰©å±•é˜…è¯»

- [Scikit-learn æ··æ·†çŸ©é˜µæ–‡æ¡£](https://scikit-learn.org/stable/modules/generated/sklearn.metrics.confusion_matrix.html)
- [æœºå™¨å­¦ä¹ è¯„ä¼°æŒ‡æ ‡è¯¦è§£](https://towardsdatascience.com/understanding-confusion-matrix-a9ad42dcfd62)
- [ä¸å¹³è¡¡æ•°æ®çš„å¤„ç†æ–¹æ³•](https://machinelearningmastery.com/tactics-to-combat-imbalanced-classes-in-your-machine-learning-dataset/)

---

**æ€»ç»“**ï¼šæ··æ·†çŸ©é˜µæ˜¯ç†è§£åˆ†ç±»æ¨¡å‹æ€§èƒ½çš„é‡è¦å·¥å…·ï¼Œå®ƒä¸ä»…æä¾›äº†å‡†ç¡®çš„æ•°å€¼ç»Ÿè®¡ï¼Œæ›´é‡è¦çš„æ˜¯å¸®åŠ©æˆ‘ä»¬å‘ç°æ¨¡å‹çš„ä¸è¶³ä¹‹å¤„ï¼ŒæŒ‡å¯¼åç»­çš„ä¼˜åŒ–æ–¹å‘ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œåº”è¯¥å°†æ··æ·†çŸ©é˜µä½œä¸ºæ¨¡å‹è¯„ä¼°çš„æ ¸å¿ƒå·¥å…·ä¹‹ä¸€ã€‚